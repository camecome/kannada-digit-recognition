# Распознавание рукописных цифр языка Kannada

Автор: Кривогуб Дмитрий

## Постановка задачи

Цель проекта — разработка системы автоматического распознавания рукописных цифр Kannada (язык в Индии) по изображению символа. Система принимает изображение цифры и определяет соответствующий класс от 0 до 9. В качестве основы использован ноутбук с [Kaggle](https://www.kaggle.com/code/shahules/indian-way-to-learn-cnn).

## Формат входных и выходных данных

**Вход:** одноканальное изображение размером 28×28 пикселей (0-255), вытянутое в вектор.

**Выход:** метка класса цифры с максимальной вероятностью.

## Метрики

Основная метрика качества — **Accuracy**.

Ожидаемые значения Accuracy:

- Бейзлайн: 70-75%
- Основная модель: 90%+

## Валидация и тестирование

Датасет изначально содержит три части: **train**, **test** и **predict** (в оригинальном наборе данных соответствуют файлам **train.csv**, **Dig-MNIST.csv** и **test.csv**). В рамках проекта для удобства файлы были переименованы.

Во время обучения обучающая выборка дополнительно разбивается на:

- Train — 80%
- Validation — 20%

Для воспроизводимости всех операций используется `random_seed = 42`.

## Датасет

Используется датасет [Kannada MNIST](https://www.kaggle.com/competitions/Kannada-MNIST/data). Он содержит сбалансированные по классам изображения рукописных цифр. Общий размер данных: ~19 МБ.

## Моделирование

### Бейзлайн

Базовая модель (`dummy_сlassifier`) - простая сверточная сеть с одним сверточным слоем и классификатором.

### Основная модель

Основная модель (`conv_classifier`) - сверточная нейронная сеть с ~235k обучаемыми параметрами.
Перед обучением выполняется предобработка данных: нормализация изображений и аугментация обучающей выборки.

## Setup

Для управления виртуальными окружениями используется **conda**, для установки зависимостей — **Poetry**. Минимальная версия Python: 3.13.

Для настройки окружения и воспроизведения проекта выполните:

```bash
# Клонирование репозитория
git clone https://github.com/camecome/kannada-digit-recognition.git
cd kannada-digit-recognition

# Создание conda-окружения
conda create -n kannada_mnist_env python=3.13
conda activate kannada_mnist_env

# Установка зависимостей проекта через Poetry
poetry install --no-root --with dev

# Установка хуков
pre-commit install

# Проверка всех файлов
pre-commit run --all-files

```

Для загрузки данных из Yandex Cloud:

```bash
dvc pull
```

## Train

Чтобы запустить тренировку, выполните команду из корня репозитория:

```bash
python -m kannada_mnist.commands train \
    --model=<НАЗВАНИЕ МОДЕЛИ> \
    --output_dir=<ДИРЕКТОРИЯ ДЛЯ СОХРАНЕНИЯ ЧЕКПОИНТА>
```

Здесь и дальше `--model` - название модели: `dummy_classifier` или `conv_classifier`.
После выполнения команды чекпоинт будет сохранен в `<НАЗВАНИЕ МОДЕЛИ>.ckpt`.
По умолчанию `output_dir=models/`

Для тестирования:

```bash
python -m kannada_mnist.commands test \
    --model=<НАЗВАНИЕ МОДЕЛИ> \
    --path_to_ckpt=<ПУТЬ К ЧЕКПОИНТУ>
```

По умолчанию `path_to_ckpt=models/<НАЗВАНИЕ МОДЕЛИ>.ckpt`.

## Production preparation

### Экспорт в ONNX

Для конвертации lightning-чекпоинта в ONNX:

```bash
python -m kannada_mnist.commands export_to_onnx \
    --model=<НАЗВАНИЕ МОДЕЛИ> \
    --path_to_ckpt=<ПУТЬ К ЧЕКПОИНТУ> \
    --output_dir=<ДИРЕКТОРИЯ ДЛЯ СОХРАНЕНИЯ ONNX-ФАЙЛА>
```

После выполнения команды сконвертированная модель будет сохранена в файле `<НАЗВАНИЕ МОДЕЛИ>_onnx.onnx` в указанной директории `output_dir`.
По умолчанию `path_to_ckpt=models/<НАЗВАНИЕ МОДЕЛИ>.ckpt`, `output_dir=models/`.

## Infer

### Локальный инференс из lightning-чекпоинта

**Формат входных данных:** CSV-файл, каждая строка состоит из `id` строки и вектора из 784 чисел (0–255).
**Формат выходных данных:** CSV-файл `predictions.csv` с колонками `id` и `label` (`id` строки и предсказанный класс).

Для получения предсказаний выполните:

```bash
python -m kannada_mnist.commands predict \
    --model=<НАЗВАНИЕ МОДЕЛИ> \
    --input_file=<ПУТЬ К CSV ФАЙЛУ> \
    --output_file=<ПУТЬ К CSV ДЛЯ ПРЕДСКАЗАНИЙ> \
    --path_to_ckpt=<ФАЙЛ С ЧЕКПОИНТОМ МОДЕЛИ>
```

По умолчанию `input_file=data/predict.csv`, `output_file=data/<НАЗВАНИЕ МОДЕЛИ>_predictions.csv`, `path_to_ckpt=models/<НАЗВАНИЕ МОДЕЛИ>.ckpt`.
